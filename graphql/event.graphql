"Kiểu dữ liệu Event"
type Event {
    id: ID!
    title: String!
    description: String
    location_id: String!
    location: Location @belongsTo
    start_date: String!
    end_date: String!
    organizer: String!
    topic: String
    capacity: Int!
    waiting_capacity: Int
    image_url: String
    current_status: String
    current_approval_status: String

    # Lịch sử trạng thái (mảng object)
    status_history: [StatusHistory!]
    # Lịch sử phê duyệt
    approval_history: [ApprovalHistory!]
    # Danh sách diễn giả
    speakers: [Speaker!]

    created_at: String
    updated_at: String
}

"Object kiểu cho trạng thái"
type StatusHistory {
    name: String!
    sequence: Int!
    changed_at: String!
}

"Object kiểu cho phê duyệt"
type ApprovalHistory {
    name: String!
    sequence: Int!
    changed_at: String!
}

"Object kiểu cho diễn giả"
type Speaker {
    name: String!
    email: String
    phone: String
    avatar_url: String
    organization: String
}

"Input type cho diễn giả"
input SpeakerInput {
    name: String!
    email: String
    phone: String
    avatar_url: String
    organization: String
}

extend type Query {
    events: [Event!]!
        @field(resolver: "App\\GraphQL\\Queries\\EventResolver@all")
    event(id: ID!): Event
        @field(resolver: "App\\GraphQL\\Queries\\EventResolver@find")
}

extend type Mutation {
    "Tạo sự kiện mới"
    createEvent(
        title: String!
        description: String
        location_id: String!
        start_date: DateTime!
        end_date: DateTime!
        organizer: String!
        topic: String
        capacity: Int!
        waiting_capacity: Int
        image_url: String
        speakers: [SpeakerInput!]
    ): Event!
        @middleware(checks: ["jwt.auth", "active"])
        @checkPermission(permission: "create-event")
        @field(resolver: "App\\GraphQL\\Mutations\\EventMutation@create")

    updateEvent(
        id: ID! @eq
        title: String
        description: String
        location_id: String
        start_date: DateTime
        end_date: DateTime
        organizer: String
        topic: String
        capacity: Int
        waiting_capacity: Int
        image_url: String
        speakers: [SpeakerInput!]
    ): Event
        @middleware(checks: ["jwt.auth", "active"])
        @checkPermission(permission: "update-event")
        @field(resolver: "App\\GraphQL\\Mutations\\EventMutation@update")

    "Chuyển sự kiện sang trạng thái tiếp theo"
    advanceStatus(id: ID!): Event
        @middleware(checks: ["jwt.auth", "check.permission", "active"])
        @checkPermission(permission: "add-event-status")
        @field(resolver: "App\\GraphQL\\Mutations\\EventMutation@advanceStatus")

    "Hủy sự kiện (thêm trạng thái CANCELLED)"
    cancelEvent(id: ID!): Event
        @middleware(checks: ["jwt.auth", "active"])
        @checkPermission(permission: "cancel-event")
        @field(resolver: "App\\GraphQL\\Mutations\\EventMutation@cancelEvent")

    "Thêm trạng thái phê duyệt sự kiện"
    updateApprovalStatus(
        id: ID!
        status: String! # Chỉ 'APPROVED' hoặc 'REJECTED'
    ): Event
        @middleware(checks: ["jwt.auth", "active"])
        @checkPermission(permission: "approve-event")
        @field(
            resolver: "App\\GraphQL\\Mutations\\EventMutation@updateApprovalStatus"
        )

    "Xóa sự kiện"
    deleteEvent(id: ID! @eq): Event
        @middleware(checks: ["jwt.auth", "active"])
        @delete
}
